## 数据表处理工具

此工具用于数据表的搜索，及使用模板生成代码，表关系建立，级联表数据删除，快速建表

支持 mysql,postgresql,oracle

### 背景

使用过 mybatis 的代码生成和网上一些代码生成，但都是需要二次修改，包括基本类，包名，工具类等，如果能获取到元数据，可以自定义模板，将方便很多。

### 数据库配置

1. 配置数据库信息,可以有两种方式进行配置
   * src/main/resources/com/sanri/config/jdbcdefault.properties （永久配置）
   * 打开 sql 客户端工具，增加连接 （临时配置）
   * 打开数据表配置工具，添加连接（这将会保存在你的本地缓存中，只会保存最后一次的配置，但对于服务器还是临时配置）

### 基本使用

1. 选择连接和数据库，将会自动刷新出所有表信息
2. 可以刷新连接和数据库，点击右边刷新按扭，绿色的添加按扭用于临时添加连接，永久添加连接需要在配置文件中配置
3. 搜索表，有两种搜索方式
   * 直接搜索，可搜索表名，表注释，列，列注释
   * 指定域搜索，可只搜表或列 table:表名 或 column:列名
   * 在超过 10 个字符后将会键入字符将会直接发起搜索，或者你可以按下回车键，右边按扭只是一个摆设 
4. 层级功能 
   * 点击【多表方案生成】，对当前数据库的某些特定表使用后面提到的方案来生成相应代码
   * 点击【项目构建】，使用 tkmbatis 模板来生成可以直接运行的代码
   * 点击【快速建表】，可以参照以前的表字段名称，类型，长度，以即使用翻译来创建字段名来创建表
5. 在表上【右键】，选择相应工具进行操作
   - 选择【模板代码...】生成后，将会打开一个模板代码生成对话框，初始打开是空的，你需要新加模板，有现成的模板可以用，地址为 [现有模板地址]( https://gitee.com/sanri/resource/tree/master/sanri-tools-maven/sanritoolsconfig/tableTemplate )
   - 点击【查看属性列】，可以用逗号的形式拼接当前表的所有列，这在有些时候会提供方便
   - 点击 【tkmybatis 模板生成】，打开  tkmybatis 模板生成对话框，和最顶层的项目构建是同样的功能 

### 代码生成功能

1. 简单代码生成，右键【模板代码...】
   * 切换模板，点击生成代码，依次生成你需要的代码
   * 点击查看【可用变量】，查询现在可以在模板中使用的变量
   * 点击【新模板】，可以使用上一步查到的变量来新建模板，模板语法为 velocity 模板语法 
   * 然后先点击【生成代码】，然后点击【下载代码】，可以将之前生成的代码以压缩包形式下载，单个文件无需解压不会形成压缩包，多次模板生成文件可以合并成一个压缩包而不是重复下载多次。
2. 方案代码生成，右键【模板代码...】
   * 点击【方案】，打开方案配置，这里可以查到所有保存了的方案
   * 点击【新方案】，选择多个模板配置你需要的方案
   * 点击需要的方案即可下载当前表的所有模板代码
3. 多表方案生成，点击顶层的 【多表方案生成】
   * 选择表和方案
   * 点击【生成】就会下载生成好的压缩包，目前仅支持 java 文件，所以 xml 会取 java 后缀，需要手动修复 
4. tkmybatis 方案生成代码 
   * 点击【项目构建】，只需要填写你的基础包信息，将直接生成可运行的 springboot 项目，增删改查将会写到同一个 Controller 中，但一般情况下需要进行二次开发
   * 现已经在开发表关系维护，后续将直接生成有表关系的查询与维护，对于大部分代码是不需要进行二次开发的
   * 可以在左边选择需要生成的表，这种生成一般在简单的字典表，配置表中有用
   * 生成后的注意事项
      * 因为生成的项目使用了我的组件，所以你还得把我的 `web-ui` 组件安装到你的 maven 仓库
      * 项目使用了 `lombok` ，你的开发工具需要安装 lombok 插件
      * 如果 maven 还有报错，检查是否包没有下载下来，删除仓库然后重新下载

### 快速建表功能 

在企业开发中，一般来新需求后有很大可能是需要建新表的，这时除了表的设计，字段的取名也是个比较大的问题，取得好的话后面开发会很方便，取得不好还要看注释才知道，有的人可能不写注释，还有一种情况是字段的取名及类型可能需要依赖其它的表才能更好的关联，比如 postgresql 就需要类型完全一致才能连接，最好字段的长度也一致，但很有可能项目已经接手很多人了，新来的人可能不知道到哪去找这个字段就自己定义了一个，可能到后面又要来修改类型，表数据量大的话运维就得麻烦了，所以才有了这个快速建表功能，哎，一大堆废话，其实功能就是围绕这个展开的。

点击 【快速建表】 ，左边展示的是和主界面一样的表搜索功能 ，这个用来搜索你需要找的字段，右边用来新建表和字段

只需要左边表格的列勾选一下，就可以把当前字段自动添加到右边的新建表中，当然右边新加的列也会同步勾选三左边表格列

【设计暂存】 功能用于把当前设计暂存，可能需要切换数据库查看别的库的某个字段是如何设计的

点击 【查看总 DDL】 用于展示当前设计表的 DDL 语句，你可以进行再次修改，你修改的语句我不会保存，所以记得及时存档，然后点击【执行】可以在当前库按照语句来创建数据表

点击【添加翻译列】可以把你想到的中文列，使用英语来翻译并添加到数据列中，类型默认为 varchar



## 效果展示

* 首页，可以切换连接和数据库
* 点击不同的表，查看表结构

![](http://pic.yupoo.com/sanri1993/113cefa3/e5ab1197.png)

* 表上右键，模板代码，最主要的功能就是这里面的
* 也可以以逗号拼接形式查看当前表的所有列

![](http://pic.yupoo.com/sanri1993/392a22d6/5fda8e5d.png)

* 左边展示的是模板，右边展示的是模板生成的代码预览
* 可以新增模板和查看可用变量
* 点击方案使用一个方案来生成代码

![](http://pic.yupoo.com/sanri1993/6fa11d7c/50fbc29f.png)

* 方案就是各种模板的组合 
* 点击方案就可以下载生成好的代码，可以配置方案

![](http://pic.yupoo.com/sanri1993/127e7db0/5b5d546f.png)

* 也可以在代码界面直接复制当前生成的代码，点击复制代码，弹出这个对话框 

![](http://pic.yupoo.com/sanri1993/5c94b393/9d18cfce.png)

* 支持多表使用方案生成，这里选择的表就是你在主界面搜索的表，当然，你还可以进行进一步筛选

![](http://pic.yupoo.com/sanri1993/48dee396/d72eb722.png)

* 支持使用 tk.mybatis 生成可以支持运行的 springboot 项目 

  ![](http://pic.yupoo.com/sanri1993/beb9dec5/6c4b4f5e.png)

* 快速建表主界面

  ![](http://pic.yupoo.com/sanri1993/0b46f676/330e7f2b.png)

* 快速建表执行 DDL 界面

  ![](http://pic.yupoo.com/sanri1993/539cb9fd/6d32a301.png)

* 快速建表添加翻译列

  ![](http://pic.yupoo.com/sanri1993/94e8d121/dd6dd033.png)